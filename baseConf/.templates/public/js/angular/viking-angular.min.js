angular.module("viking.angular",["viking.angular.templates","ngTagsInput"]),function(){var convertDateStringsToDates,regexISO8601DateFormat;return regexISO8601DateFormat=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+)|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d)|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d)/,convertDateStringsToDates=function(input){var key,match,value;if("object"!=typeof input)return input;for(key in input)input.hasOwnProperty(key)&&(value=input[key],match=void 0,"string"==typeof value?value.match(regexISO8601DateFormat)&&(input[key]=new Date(value)):"object"==typeof value&&convertDateStringsToDates(value))},angular.module("viking.angular").config(["$httpProvider",function($httpProvider){$httpProvider.defaults.transformResponse.push(function(responseData){return convertDateStringsToDates(responseData),responseData})}])}(),angular.module("viking.angular").directive("vkErrors",["$timeout",function(){return{restrict:"EA",replace:!0,scope:{vkErrors:"="},templateUrl:"templates/errors-template.html",link:function(){}}}]),angular.module("viking.angular").directive("vkMessages",["$timeout",function($timeout){return{restrict:"AE",replace:!1,scope:{vkChannel:"@"},templateUrl:"templates/messages-template.html",link:function(scope){return scope.vkChannel=scope.vkChannel||"VK_MESSAGES_DEFAULT_CHANNEL",scope.messages=[],scope.removeMessage=function(message){return scope.messages.splice(scope.messages.indexOf(message),1)},scope.$on(scope.vkChannel,function(e,message){return scope.messages.push(message),$timeout(function(){return scope.removeMessage(message),scope.$apply()},1e4),scope.$apply()})}}}]),angular.module("viking.angular").directive("vkPagination",function(){return{restrict:"AE",scope:{vkPageChange:"&",vkPagination:"="},templateUrl:"templates/pagination-template.html",link:function(scope){return scope.pages=[],scope.setPageCount=function(pageCount){return scope.pageCount=pageCount,scope.pages=_.range(1,pageCount+1),void 0===scope.currentPage&&scope.setCurrentPage(1),scope.currentPage>scope.pageCount?scope.setCurrentPage(scope.pageCount):void 0},scope.$watchCollection("vkPagination",function(paginationInfo){return console.log(paginationInfo),paginationInfo&&(paginationInfo.pageCount&&scope.setPageCount(paginationInfo.pageCount),paginationInfo.page)?scope.currentPage=paginationInfo.page:void 0}),scope.setCurrentPage=function(page){return 1>page&&(page=1),page>=scope.pageCount&&(page=scope.pageCount),scope.currentPage!==page?(scope.currentPage=page,scope.vkPageChange({$page:page})):void 0}}}}),angular.module("viking.angular").directive("vkTags",["$timeout","$viking","$http",function($timeout,$viking,$http){return{restrict:"AE",replace:!1,scope:{ngModel:"=",source:"="},templateUrl:"templates/tags-template.html",link:function(scope){return scope.loadTags=scope.source||function(query){return $http.post($viking.route(".getTags"),{query:query})}}}}]),angular.module("viking.angular").factory("$viking",function(){var capitalize,parseOptions,self;return self={},self.init=function(portletId,scope){return self.portletId=portletId,self.scope=scope,_.assign(scope,VK.getPortletData(portletId))},self.ready=function(callback){return AUI().ready("liferay-portlet-url",callback)},self.route=function(route,params,routeType){var i,liferayURL,routeParts,value,_i,_len;for(null==params&&(params={}),null==routeType&&(routeType="resource"),liferayURL=function(){switch(!1){case"render"!==routeType:return Liferay.PortletURL.createRenderURL();case"action"!==routeType:return Liferay.PortletURL.createActionURL();case"permission"!==routeType:return Liferay.PortletURL.createPermissionURL();default:return Liferay.PortletURL.createResourceURL()}}(),liferayURL.setPortletId(self.portletId),i=_i=0,_len=params.length;_len>_i;i=++_i)value=params[i],liferayURL.params[i]=value;return routeParts=route.split("."),liferayURL.params.VIKING_controller=routeParts[0]||self.scope.VIKING_FRAMEWORK_PARAMS.controllerName,liferayURL.params.VIKING_action=routeParts[1],liferayURL.toString()},self.showMessage=function(type,channel,text){var message;return message={type:type,text:text},_.defer(function(){return self.scope.$broadcast(channel,message)})},capitalize=function(word){return word.charAt(0).toUpperCase()+word.slice(1)},parseOptions=function(options){return"string"==typeof options?{text:options,channel:"VK_MESSAGES_DEFAULT_CHANNEL"}:options},_.each(["success","error","info"],function(type){return self["show"+capitalize(type)]=function(options){var channel,text,_ref;return _ref=parseOptions(options),channel=_ref.channel,text=_ref.text,self.showMessage(type,channel,text)}}),self});